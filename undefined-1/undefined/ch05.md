# CH05 책임과 메시지

## 책임에 대한 수행은 자율성이 보장되어야 한다

책의 전반에서 계속해서 객체의 책임을 강조하고 있는데, 책임 자체 뿐만이 아니라 책임을 가진 객체가 이를 자율적으로 처리할 수 있어야 한다는 것도 강조하고 있다. 객체의 자율성이 보장될 수록 설계의 품질이 좋아지기 때문이다. 자세한 사항은 뒤에서 더 말하고 있는데 일단 자율적이지 못한 객체와 자율적인 객체의 차이를 알아보자.

## 자율적인 객체와 그렇지 못한 객체

<figure><img src="../../.gitbook/assets/2023. 4. 5. - 0 2.jpg" alt=""><figcaption></figcaption></figure>

그림 5.1이 자율성이 보장된 객체이고 그림 5.2가 자율성이 제한된 객체의 모습이다.

그림 5.1 에서는 객체가 증언할 책임은 있지만 증언을 위해서 구체적으로 방법이나 절차등이 강제되지 않은 상황이다. 즉, 증언만 '알아서 잘' 하면 되는 것이지 세세하게 절차나 세부사항등에 대해서 강제되지 않았다.

반면에 그림 5.2에서는 증언이라는 책임을 위해서 상위 객체가 세세하게 방법까지 강제하고 있다. 책임 수행은 하고 있지만 전혀 자유롭지 못하고 시키는대로 해야만 하는 객체가 되었다.

둘다 결국 협력이라고 표현할 수는 있지만 객체의 자율성에서 큰 차이가 난다.

## '어떻게'가 아니라 '무엇'을

자율적인 책임의 특징은 객체가 '어떻게' 해야 하는가가 아니라 '무엇'을 해야 하는가를 설명한다는 것이다. 위 예시에서 이미 이러한 모습을 확인할 수 있었다.

## 메시지와 메서드

특별한 내용은 아니었고, 메시지와 메서드의 개념을 다시 짚어보는 내용이었다. 객체간 협력을 위해서 요청 및 응답을 하는 수단이 바로 메시지이다. 메서드는 이렇게 메시지를 받았을 때 내부적으로 책임을 수행하고 응답을 하기위해서 '자율적으로' 선택하고 이용하는 말그대로 메서드를 뜻한다.

핵심적인 내용은 메시지는 객체들이 서로 협력하기 위해서 사용할 수 있는 유일한 의사소통 수단이라는 것이며, 메시지를 받은 객체는 내부적으로 알아서 메서드를 선택하여 책임을 수행하게 된다는 것이다.

## 다형성

다형성에 대해서 설명한 여러 문구를 많이 봐왔지만 이 책에서 정리된 문구가 마음에 들어서 그대로 가져왔다.

> 다형성이란 서로 다른 유형의 객체가 동일한 메시지에 대해 서로 다르게 반응하는 것을 의미한다. 좀 더 구체적으로 말해 서로 다른 타입에 속하는 객체들이 동일한 메시지를 수신할 경우 서로 다른 메서드를 이용해 메시지를 처리할 수 있는 메커니즘을 가리킨다.

더 줄이자면 '서로 다른 객체가 동일한 메시지에 대해서 서로 다른 방식으로 처리하는 것'이라고 할 수 있겠다. 1 개의 메시지 N 개의 메서드라고도 표현할 수 있다.

다형성 덕분에 메시지 송신자는 수신자가 누가 될지에 관해서 신경쓸 필요가 전혀 없고 누가 처리해주든 이 요청을 처리해 줄 것이라는 믿음을 가지고 송신자 본인의 책임에 집중하면 된다. 이는 곧 설계가 더 유연하고 확장 가능한 구조라는 것을 의미한다.

## 유연하고 확장 가능한 협력의 의미

다형성을 발휘할 수록 더 유연하고 확장 가능한 협력 구조가 나온다. 이를 자세히 이해해보자.

### 유연하다

다형성을 사용하면 송신자는 수신자가 누구인지 신경쓰지 않고 메시지를 보낼 수 있다. 메시지 수신자에 대한 관심을 완전히 없애버릴 수 있는 것이다. 이를 수신자 입장에서 보면 송신자에 대한 파급 효과 없이 편하게 변경할 수 있다. 수신자 입장에서 유연하게 변경 사항에 대한 수용이 가능하다는 것이다.

### 확장 가능하다

이것도 결국 수신자가 송신자에게 파급 효과가 없는 덕분이다. 도메인의 변경사항이 생겨서 이를 처리할 수신자가 더 필요한 경우가 생겨도 송신자에게 아무런 파급 효과가 없다. 그래서 수신자를 더 늘리는 것이 매우 쉬워진다.

## 송신자와 수신자를 약하게 연결하는 메시지

이처럼 다형성은 좋은 구조의 협력을 만들어내고, 이러한 다형성을 근본적으로 지탱하는 것은 객체들간에 주고 받는 메시지이다. 메시지는 송신자와 수신자 사이의 결합도를 낮춤으로써 설계를 유연하고 확장 가능하게 해준다.

> 메시지를 기반으로 한 두 객체 사이의 이 낮은 결합도가 바로 설계를 유연하고 확장 가능하며 재사용 가능하게 만드는 비결이다.

다시 강조되는 부분인데, 그래서 객체를 설계할 때 객체 자체에 집중하면 안되고 협력이라는 큰 문맥에서 '어떤 메시지를 통해서 협력이 발생할 것인가'에 집중하고 이러한 메시지를 기반으로 협력하는 객체들의 관계를 발견해야한다. 이 과정 속에서 객체에게 책임이 부여되는 것이다.

> 객체지향 설계는 적절한 책임을 적절한 객체에게 할당하면서 메시지를 기반으로 협력하는 객체들의 관계를 발견하는 과정이다.

> 객체가 어떤 메시지를 수신하고 처리할 수 있느냐가 객체의 책임을 결정한다. 책임-주도 설계 방법에서는 What/Who 사이클에 따라 협력에 참여할 객체를 결정하기 전에 협력에 필요한 메시지를 먼저 결정한다. 메시지가 결정된 후에야 메시지를 수신할 후보를 선택하는 것으로 초점이 이동한다.

결국 설계시 최우선 고려 사항은 '메시지' 이다. 메시지가 곧 협력이라는 추상적 개념의 구체적 조각이다.

## '어떻게'가 아니라 '무엇' 이다

> 메시지가 '어떻게' 해야 하는지를 지시하지 말고 '무엇'을 해야 하는지를 요청해야한다.\
> \
> '어떻게'에서 '무엇'으로 전환하는 것은 객체 인터페이스의 크기를 급격하게 감소시킨다. 인터페이스의 크기가 작다는 것은 외부에서 해당 객체에게 의존해야 하는 부분이 적어진다는 것을 의미한다.\
> \
> 결과적으로 메시지 송신자와 수신자 간의 결합도가 낮아지기 때문에 설계를 좀 더 유연하게 만들 여지가 많아지고 의도 역시 명확해진다.

## 인터페이스 설계 원칙

객체 인터페이스(여기서 말하는 인터페이스는 특정 언어의 interface 를 말하는게 아니고 외부와 맞닿은 노출된 인터페이스를 의미한다) 설계시 아래 세 가지를 기억하자.

* 좀 더 추상적인 인터페이스(구체적일 수록 자율성이 떨어진다)
* 최소 인터페이스
* 인터페이스와 구현 간에 차이가 있다는 점을 인식(캡슐화에 신경쓰자는 의미)

## 책임의 자율성이 협력의 품질을 결정한다

### 어떤 설계가 좋은 설계일까

설계의 우수함과 같은 것은 수치화 할 수 없는 것이므로 동일한 설계를 두고도 사람마다 의견이 다를 수 있다. 그렇다면 어떠한 설계가 더 좋은 설계라고 말할 수 있을까? 책에서는 그 기준으로 '다른 협력보다 이해하기 쉬워지고 유연하게 변경할 수 있는 것'을 제시한다.

그리고 협력이 이해하기 쉽고 유연하게 변경 가능하려면 객체들이 최대한의 자율성을 보장 받아야 한다. 책임이 얼마나 자율적인지가 전체적인 협력의 설계 품질을 결정하게 된다.

### 1. 자율적인 책임은 협력을 단순하게 만든다.

책임을 적절하게 추상화 함으로써 책임의 자율성을 보장해준다. 자율적인 책임은 의도를 명확하게 표현함으로써 협력을 단순화 하고 이해하기 쉽게 만든다. 앞서 살펴본 예시로 How 를 줄줄 나열할 것이 아니라 What 으로 간단하게, 적절한 추상화를 한 수준으로 메시지를 전달하면 자율성이 증대된다.

### 2. 자율적인 책임은 외부와 내부를 명확하게 분리한다.

자율적인 책임을 바탕으로 설계된 객체는 캡슐화가 잘 된다. 캡슐화가 잘 되어야만 변경이 용이해진다. 파급효과가 미칠 수 없는 안전지대가 마련되기 때문이다. 내부에 감출 수 있는, 안전지대를 이용해서 객체의 자율성이 보장될 수 있다.

캡슐화가 잘 될수록 변경의 파급효과가 객체를 넘어서 다른 객체로 전파되지 않고, 이를 위해서는 외부와 내부를 명확하게 분리하는 것이 중요하다. 이는 곧 객체간의 결합도를 낮추는 길이다.

### 3. 객체가 수행하는 책임이 자율적일수록 객체의 역할을 이해하기 쉬워진다.

인간의 인지능력 자체에 대한 한계를 전제한 이야기이다. 객체가 수행하는 책임들이 자율적이면 자율적일수록 객체의 존재 이유를 명확하게 표현할 수 있다. 객체의 책임이 자율적일 수록 객체의 응집도를 높은 상태로 유지하기가 쉬워진다.



책에서는 다섯가지를 말하고 있는데 내가 요약하는 과정에서 일부를 합치고, 축약해서 세 가지로 만들었다. 결론적으로 이번 장에서는 메시지의 역할과 중요성이 강조되었다.
