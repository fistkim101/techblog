# 웹 성능 진단하기

## 들어가며 <a href="#0" id="0"></a>

<figure><img src="http://localhost:4000/assets/images/infra/performence-architecture.png" alt=""><figcaption></figcaption></figure>

**강의자료 초반에 있던 클라이언트-서버 구조도인데 성능과 밀접한 관련이 있는 cache를 잘 시각화 해둔 것 같다**



첫 회사에서 항상 아쉬웠던 것은 B2B로 정해진 유저들을 대상으로 하는 서비스를 만들다보니 트래픽이 항상 한정적이었고, 그만큼 성능이슈가 발생할 일이 없었던 것이다. 사실 사용자가 1명이든 100명이든 그 이상이든 사용자 수와 상관없이 어플리케이션은 최선의 성능을 낼 수 있어야 한다. 하지만, 성능을 위해서라면 크게는 설계부터 작게는 개별 기능의 코드까지 충분한 고민의 시간이 필요한데 납기가 정해져있고 빨리 만들어서 빨리 팔아야하는 비즈니스 형태의 틀에서는 사실 작업 기간이 곧 비용이기 때문에 공수 확보가 쉽지 않다. 더 정확히는 의사 결정자를 ‘설득’할 명분이 없다. 특히 테크 베이스가 아닌 사람이 이러한 구조에서 결정권을 갖고 있으면 개인적인 경험으로는 설득이 거의 불가능에 가까웠다.

아무튼 개인적으로 단순히 돌아가게만 하는 것이 아니라, 성능에 대한 고민을 하며 어플리케이션을 만든다는 것은 인프라, 코드 설계, DB 구조 등 고민 해야 할 포인트들이 매우 많다는 것이고 이것이 곧 실력 향상과 밀접한 관련이 있다고 믿기 때문에 이번 챕터가 더 기다려졌다. 조금 아쉬웠던 것은 이번 소챕터 하나는 ‘웹 사이트’에 대한 성능 측정에 방점이 있었다는 것이었는데 목차를 보니 차후 부하테스트 부터 캐싱까지 해보고 싶었던 것들이 매우 많아서 굉장히 반갑고 좋았다.



## 웹 성능 측정하기 <a href="#1" id="1"></a>

강의에서 [성능을 측정해주는 사이트](https://www.webpagetest.org/) 를 소개해주고 있었는데, 여기서 여러가지를 측정해볼 수 있었다. 카테고리별로 점수를 매겨서 학점처럼 보여준다.\


> * First Byte Time : 웹 서버에서 받은 컨텐츠의 첫 번째 바이트가 얼마만에 도착했는가?
> * Keep-Alive Enabled : TCP 연결을 재사용하기 위한 Keep-Alive 설정이 되어 있는가?
> * Compress Transfer : 스크립트 파일이 Content-Encoding으로 압축되어 있는가?
> * Compress Image : 이미지를 압축했는가?
> * Cache Static Content : 정적 파일이 캐싱 설정이 되어 있는가?

\
웹 성능 예산
-------

[웹 성능 예산](http://localhost:4000/infra/2021-04-13-NEXTSTEP-%EC%9D%B8%ED%94%84%EB%9D%BC%EA%B3%B5%EB%B0%A9-%EC%9B%B9%EC%84%B1%EB%8A%A5%EC%A7%84%EB%8B%A8%ED%95%98%EA%B8%B0.html) 이란 쉽게 말해서 ‘성능을 위해서 최소한 이 예산은 넘지말자’ 라는 맥락에서 여러 지표들을 나타낸 것이다. 지표들은 정량/시간/성능 이렇게 세 카테고리로 분류될 수 있다. [웹 성능 예산에 대해 잘 정리된 브런치](https://brunch.co.kr/@sangjinkang/23) 가 있어 따로 정리하진 않겠다.

성능 부분에 관해서는 구글에서 [Page Speed Insight](https://developers.google.com/speed/pagespeed/insights/) 라는 것을 제공하고 있다. 여기서 원하는 웹 사이트의 성능을 점검해볼 수 있다.

\


<figure><img src="http://localhost:4000/assets/images/infra/pagespeed-1.png" alt=""><figcaption></figcaption></figure>

**테스트로 네이버를 돌려 봤는데 점수가 너무 낮다**

\
\


<figure><img src="http://localhost:4000/assets/images/infra/pagespeed-2.png" alt=""><figcaption></figcaption></figure>

**개선을 어떻게 해야할지 전략까지 짜준다**\


위 링크된 브런치 내용중 마지막 부분이 참 재밌었는데, 저자가 개발자인데도 기획자 입장에서 생각해봤다는 것이 참 배울만 했다. 기획자 입장에서도 단순히 ‘좀 느린 것 같은데’ 라고 개발자에게 말하면 개발자마다 받아들이는 것이 다르겠지만 대부분 그런 발언에 대해 굉장히 방어적일 것이라 생각한다. 나는 브라우저 기반으로 서비스를 제공하는 회사에 다녀본 적이 없어서 웹 성능에 대해서는 크게 고민해본 적이 없어서 저런 상황이 자주 발생하는 것인지는 모르겠다.

하지만 저러한 기획자의 불만(?)이 빈도가 높게 발생하는 것이라면 적어도 성능 예산의 개념에 근거하여 시간과 성능스코어 두 가지로는 숫자를 가지고 자기주장을 할 수 있을 것 같다. 반대로 개발자도 막연하게 느리다고 피드백을 받는다면 숫자를 들어서 최소한의 기준을 충족하고 있다고 커뮤니케이션 할 수 있을 것 같고 애초에 개발 단계에서부터 성능 예산을 고려하여 개발하는 것이 좋겠다 싶다.

> 웹 성능 예산은 아래 예시와 같이, 정량 / 시간 / 규칙 기반으로 산정할 수 있어요. 성능 목표에는 정답이 없지만, 3초의 법칙 (3초 안에 로딩되지 않으면 53%의 사용자가 떠나고 로딩 시간이 길어질수록 사용자 이탈률이 늘어남)이 있듯, 서비스의 성능 목표를 두는 것이 필요합니다.
>
> * 메인 페이지의 모든 오브젝트 파일 크기는 10MB 미만으로 제한한다.
> * 모든 웹 페이지의 각 페이지 내 포함된 자바스크립트 크기는 1MB를 넘지 않아야 한다.
> * 검색 페이지에는 2MB 미만의 이미지가 포함되어야합니다.
> * LTE 환경에서의 모바일 기기의 Time to Interactive는 5초 미만이어야 한다.
> * Dom Content Loaded는 10초, First Meaningful Paint는 15초 미만이어야 한다.
> * Lighthouse 성능 감사에서 80 점 이상이어야한다.

\
